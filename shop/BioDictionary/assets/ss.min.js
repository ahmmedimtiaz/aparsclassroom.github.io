setTimeout(() => {
    $("#vid")[0].src += "1";
    var news = $("#vid")[0].src;
}, 1000)

var str = window.location.search;
var res = str.split("&")[0].substring(1, 16);
if (localStorage.getItem(product) === "") {
    localStorage.setItem(product, res);
}
if (res === "") {
    document.getElementById('aff').value = localStorage.getItem(product)

} else {
    document.getElementById('aff').value = res
    localStorage.setItem(product, res);

}
document.getElementById('buy').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('buy').innerText = "Please wait...."
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json");

    var raw = JSON.stringify({
        "total_amount": document.getElementById('prs').value,
        "product": product,
        "cus_name": document.getElementById('name').value,
        "email": document.getElementById('email').value,
        "college": document.getElementById('college').value,
        "hsc": document.getElementById('hscBatch').value,
        "phone": document.getElementById('phone').value,
        "aff": document.getElementById('aff').value
    });

    var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
    };

    fetch("https://asg-shop.herokuapp.com/init", requestOptions)
        .then(response => {
            return response.json()
        })
        .then(result => {
            location.href = result.GatewayPageURL
        })
        .catch(error => console.log('error', error));
}), firebase.auth().onAuthStateChanged(function(e) {
    if (e) {
        var t = e.phoneNumber;
        document.getElementById("Contact-Number").value = t, document.getElementById("app").style.display = "none", document.getElementById("cup").style.display = "block"
    } else document.getElementById("app").style.display = "block", document.getElementById("cup").style.display = "none"
}), document.getElementById("app").addEventListener("click", e => { e.preventDefault(), document.location.href = "../index.html" });
var cupon, cpn = document.getElementById("cpnCheck");

function func() {
    cupon = document.getElementById("cupon").value;
    notdis()
}

function notdis() {
    if (document.getElementById('cupon').value != "") {
        document.getElementById("cpnCheck").disabled = false;
    } else {
        document.getElementById("cpnCheck").disabled = true;
    }
}
notdis()

function suc() { "" === document.getElementById("cupon").value ? document.getElementById("cpnCheck").disabled = !0 : document.getElementById("cpnCheck").disabled = !1 }
cpn.addEventListener('click', (e) => {
    e.preventDefault();
    const cupV = document.getElementById('cupon');
    const cpnCode = cupV.value;
    cupV.value = "Checking..";
    cupV.disabled = true;
    cpn.disabled = true;
    const fix = 800;
    const pls = 500;
    fetch('https://script.google.com/macros/s/AKfycbw4UrerGwUbMxJIthi-pgx_rApreJ6vsPW1FxiA05Ey6pq92i3LccYwS-GjBFwDzoLw/exec?Cupon=' + cpnCode.toUpperCase())
        .then((res) => {
            return res.json();
        })
        .then((loadedData) => {
            if (loadedData.status === "success") {
                var nes = pls - loadedData.Off;
                document.getElementById('price').value = nes;
                document.getElementById('prs').value = nes;
                document.getElementById('sprice').innerText = nes;
                document.getElementById('cupn').value = loadedData.Cupon;
                cpn.style.cursor = "not-allowed";
                cupV.value = loadedData.Cupon;
                cupV.disabled = true;
                cpn.innerText = "Applied ✔"
                cpn.disabled = true;
                var percent = Math.round(((parseInt(loadedData.Off) + (fix - pls)) / fix) * 100);
                document.getElementById('how').style.display = "block";
                document.getElementById('how').innerHTML = `<span style="color:red;">${percent}%</span> discounted by <span style="color:blue;">"${loadedData.Cupon}"</span> promo code`;
                document.getElementById('smp').innerHTML = "<del style='color:red'> " + fix + " ৳</del> " + " <span style='color:green;'>" + nes + " ৳</span>";
                swal({
                    title: "Alhamdulillah ❤",
                    icon: "success",
                    text: "Successfully applied!",
                    button: "Ok"
                })
                return;
            } else {
                cupV.disabled = false;
                cpn.disabled = false;
                document.getElementById('cupon').value = "";
                swal({
                    title: "Code not valid",
                    icon: "error",
                    button: "Ok"
                }).then(() => {
                    return notdis()
                })
            }
        }).catch(() => {
            document.getElementById('cupon').value = "";
            notdis()
            swal({
                title: "Cupon can't be Empty 😶",
                icon: "error",
                button: "Ok"
            }).then(() => {
                return notdis()
            })
        })

})