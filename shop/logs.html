<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment History</title>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-analytics.js"></script>
    <script src="./assets/js/script.js"></script>
</head>

<body>

    <div id="stat">
        <h3 style="text-align: center;" id="title">loading...</h3><br><br>
    </div>


    <script>
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

                var urlencoded = new URLSearchParams();
                urlencoded.append("uid", user.uid);

                var requestOptions = {
                    method: 'POST',
                    headers: myHeaders,
                    body: urlencoded,
                    redirect: 'follow'
                };

                fetch("https://asg-shop.herokuapp.com/logs", requestOptions)
                    .then(response => response.json())
                    .then((loadedData) => {
                        var data = loadedData.data;
                        document.getElementById('title').innerHTML = "Payment History";
                        data.forEach((element, idx) => {
                            idx++
                            const content = `
                        <div>
                           Invoice No. ${element.Invoice} <br>
                           Product Name : ${element.ProductName} <br>
                           Tranx Id : ${element.tran_id}<br>
                           Payment Status : ${element.status}
                        </div><hr>
                        `;
                            document.getElementById('stat').innerHTML += content;
                        });

                    }).catch(error => document.getElementById('title').innerHTML = "Payment History not found !");
            } else {
                document.getElementById('stat').innerHTML = "not logged in";
            }
        })
    </script>
</body>

</html>